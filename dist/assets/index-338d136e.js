import{f as d,r as l,s as o,j as _,a as r,u as I}from"./index-fc1ab4af.js";import{T as c}from"./PostPreview-8c207748.js";import{o as u,P as g}from"./ui-69a91592.js";import{f as A}from"./fetchTags-9b37f7f0.js";import{A as P,m as v}from"./index-71e76787.js";const D="_wrapper_1f0hk_1",h={wrapper:D},E="_wrapper_1eb6l_1",f="_wrapper__input_1eb6l_7",O="_wrapper__tags_1eb6l_15",T="_tags__used_1eb6l_20",i={wrapper:E,wrapper__input:f,wrapper__tags:O,tags__used:T};async function N(a){if(await d()){const n=new Headers;n.append("Content-Type","application/json"),n.append("Access-Control-Allow-Origin","*"),n.append("Access-Control-Allow-Methods","GET,POST,PUT,PATCH,DELETE");const t={method:"GET",headers:n,redirect:"follow",credentials:"include"};return await fetch(`http://localhost:3000/tags/${a}`,t).then(s=>s.json()).catch(s=>console.log("error",s))}else throw new Error("user unauthorized")}let S;function y(a){clearTimeout(S),S=setTimeout(()=>o.postStore.search(a,o.postStore.getSearchQuery.tags),300)}const b=u(()=>{const[a,n]=l.useState([]),[t,s]=l.useState();return l.useEffect(()=>{y(t??"")},[t]),l.useEffect(()=>{(async()=>{const e=await A(o.postStore.getSearchQuery.query);n(e.filter(m=>o.postStore.getSearchQuery.tags.every(p=>p.id!==m.id)))})()},[o.postStore.getSearchQuery.tags,o.postStore.getSearchQuery.query]),_("div",{className:i.wrapper,children:[r("input",{className:i.wrapper__input,type:"text",value:t??"",onChange:e=>{s(e.target.value)}}),r("div",{className:i.wrapper__tags,children:_(P,{mode:"sync",children:[o.postStore.getSearchQuery.tags.map((e,m)=>r(v.div,{layout:!0,initial:{scale:0,opacity:.5},animate:{scale:1,opacity:1},exit:{scale:0,opacity:.5},children:r(c,{type:"dark",text:e.content,className:i.tags__used,id:e.id,onClick:()=>{o.postStore.search(o.postStore.getSearchQuery.query,o.postStore.getSearchQuery.tags.filter(p=>p.id!==e.id))}})},m+e.id)),Array.isArray(a)&&a.map(e=>r(v.div,{layout:!0,initial:{scale:0,opacity:.5},animate:{scale:1,opacity:1},exit:{scale:0,opacity:.5},children:r(c,{type:"dark",text:e.content,className:i.tags__suggested,id:e.id,onClick:()=>{(!o.postStore.getSearchQuery.tags||o.postStore.getSearchQuery.tags.every(m=>m.id!==e.id))&&o.postStore.search(o.postStore.getSearchQuery.query,[...o.postStore.getSearchQuery.tags,e])}})},e.id))]})})]})}),R=()=>{const a=I();return l.useEffect(()=>{if(window.location.pathname==="/search"){const n=a.search.split("?").filter(s=>s.length),t={tags:[],query:""};(async()=>{for(const s of n){const e=s.split("=");if(e[0]==="tag")for(const m of e[1].split("&"))t.tags.push(await N(m));e[0]==="q"&&(t.query=e[1])}o.postStore.search(t.query,t.tags)})()}},[a]),r(b,{})},x=()=>(l.useEffect(()=>()=>{o.postStore.search("",[],!1)},[]),_("div",{className:h.wrapper,children:[r(R,{}),r(g,{})]}));export{x as SearchPage};
